<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Пассажир</title>
  <style>

    body {
	    margin: 0;
	    font-family: sans-serif;
	    height: 100vh;
	    display: flex;
	    flex-direction: column;
	    overflow: hidden;
		padding-top: 20px; /* 👈 удалить эту строку */
	   
    }


    header {

      color: white;
      padding: 10px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      
    }

    .logo-text-container {
      display: flex;
      align-items: center;
      width: 100%;
    }
	
	
	.inner-header {
	  background: #4facfe;
	  color: white;
	  padding: 10px 15px;
	  margin-bottom: 10px;
	  display: flex;
	  align-items: center;
	  justify-content: space-between;
	  border-radius: 10px;
	}
	
	
    .logo {
      font-size: 20px;
      font-weight: bold;
      white-space: nowrap;
      margin-right: 10px;
    }

    .ticker {
      overflow: hidden;
      white-space: nowrap;
      flex: 1;
    }

    .ticker-text {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 15s linear infinite;
      color: white;
      font-size: 14px;
    }

    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    .viewport {
      flex: 1;
      overflow: hidden;
      position: relative;
      padding-top: 30px;
    }

    .content {
      display: flex;
      transition: transform 0.3s ease;
      height: 100%;
      width: 300vw;
    }

    .tab-page {
      min-width: 100vw;
     
      box-sizing: border-box;
    
    }

    .container {
      width: 90%;
      max-width: 600px;
      margin: 10px auto 30px;
      padding: 20px;
      box-sizing: border-box;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      background: #4facfe;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #00c6ff;
    }

    .quick-btn {
      background: #ff9800;
    }

    .quick-btn:hover {
      background: #ffa726;
    }

    .tabs {
      display: flex;
      justify-content: space-around;
      background: #4facfe;
      position: fixed;
      bottom: 20px; /* 👈 Изменено с 0 на 60px */
      width: 100%;
      z-index: 1000;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 15px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .tab.active {
      background: #00c6ff;
    }

    .order-summary {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 10px 20px;
      border-radius: 10px;
      z-index: 1000;
      max-width: 90%;
      display: none;
    }

    .order-summary p {
      margin: 5px 0;
    }

    .order-summary::before {
      content: "Ваш заказ";
      display: block;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .location-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background: url('https://cdn-icons-png.flaticon.com/512/684/684908.png') no-repeat center;
      background-size: contain;
      vertical-align: middle;
      margin-right: 5px;
    }

    .cancel-btn, .cancel-btn-mg {
	  background: #f44336;
	  display: none;
	  width: 100%;
	  max-width: 600px;
	  margin: 30px auto 70px;
	  border-radius: 8px;
	}


    .cancel-btn:hover, .cancel-btn-mg:hover {
      background: #e53935;
    }

    .hidden { display: none !important; }
  </style>

  
  

  
  
  
  
  </head>
 


<body>
  <header>
   
  </header>

  <div class="order-summary" id="summary"></div>

  <div class="viewport">
    <div class="content" id="content">
      <div class="tab-page">
        
		
		<div class="inner-header">
		  <div class="logo">Сарыөзек Такси</div>
		  <div class="ticker">
			<div class="ticker-text">📞 Колл-центр: +7 777 123 4567 — Быстрый и надёжный сервис!</div>
		  </div>
		</div>

		  
		<div class="container" id="saryozekContainer" style="display: flex; flex-direction: column; min-height: 100%;"> 
		  <div id="saryozekForm">


		  <div id="userSummary" style="background:#f2f2f2; padding:10px; border-radius:10px; margin-bottom:15px;">
			  <p><strong>ID:</strong> <span id="showUserId">-</span></p>
			  <p><strong>Имя:</strong> <span id="showFirstName">-</span></p>
			  <p><strong>Username:</strong> <span id="showUsername">-</span></p>
			  <p><strong>Телефон:</strong> <span id="showPhone">-</span></p>
			</div>

			
			
			<h2>Заказ такси в Сарыозеке</h2>

            <label>Откуда:</label>
            <input list="fromList" id="from" placeholder="Укажите адрес отправления" />
            <datalist id="fromList"></datalist>

            <label>Куда:</label>
            <input list="toList" id="to" placeholder="Укажите адрес назначения" />
            <datalist id="toList"></datalist>

            <label>Примечание:</label>
            <textarea id="note" placeholder="Например: позвоните заранее..."></textarea>

            <button onclick="orderTaxi()" id="orderBtn">🚕 Заказать такси</button>

            <hr />

            <button class="quick-btn" onclick="orderQuick()" id="quickBtn">📍 Нужен такси по локации</button>
          </div>
		  
		   <div style="margin-top: auto; padding-bottom: 80px;">
			<button class="cancel-btn" onclick="cancelOrder()" id="cancelBtn">❌ Отменить</button>
		   </div>
		  
        </div>
      </div>

      <div class="tab-page">
        <div class="inner-header">
			  <div class="logo">Сарыөзек Такси</div>
			  <div class="ticker">
				<div class="ticker-text">📞 Колл-центр: +7 777 123 4567 — Быстрый и надёжный сервис!</div>
			  </div>
			</div>
		<div class="container" id="intercityContainer" style="display: flex; flex-direction: column; min-height: 100%;">
          

		  <div id="intercityForm">
            <h2>🛣️ Межгород</h2>

            <label>Откуда:</label>
            <select id="fromCity" onchange="updateToCityOptions()">
              <option disabled selected>Выберите город</option>
            </select>

            <label>Куда:</label>
            <select id="toCity">
              <option disabled selected>Выберите город</option>
            </select>

            <label>Цена (тг):</label>
            <input type="number" id="price" placeholder="Введите цену" />

            <label>Дата и время:</label>
            <input type="datetime-local" id="tripDate" />

            <button onclick="orderIntercity()">🚐 Заказать междугороднее такси</button>
          </div>
		  <div style="margin-top: auto; padding-bottom: 80px;">
			<button class="cancel-btn" onclick="cancelOrder()" id="cancelBtnIntercity">❌ Отменить</button>
		  </div>
        </div>
      </div>

      <div class="tab-page">
        <div class="inner-header">
		  <div class="logo">Сарыөзек Такси</div>
		  <div class="ticker">
			<div class="ticker-text">📞 Колл-центр: +7 777 123 4567 — Быстрый и надёжный сервис!</div>
		  </div>
		</div>

		
		<div class="container">
          <h2>👤 Профиль</h2>
			<div id="userInfo">
			  <p><strong>ID:</strong> <span id="userId">Загрузка...</span></p>
			  <p><strong>Имя:</strong> <span id="firstName">-</span></p>
			  <p><strong>Фамилия:</strong> <span id="lastName">-</span></p>
			  <p><strong>Username:</strong> <span id="username">-</span></p>
			</div>

			<hr />

			<label for="phoneInput"><strong>Ваш номер телефона:</strong></label>
			<input type="tel" id="phoneInput" placeholder="+7 777 123 4567" />
			<button id="saveBtn" onclick="savePhone()">✅ Подтвердить</button>
			<button id="deleteBtn" onclick="deletePhone()" style="display: none;">❌ Удалить номер</button>
			<p id="phoneStatus" style="color: green;"></p>


		
        </div>
      </div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab(0)">Сарыозек</div>
    <div class="tab" onclick="showTab(1)">Межгород</div>
    <div class="tab" onclick="showTab(2)">Профиль</div>
  </div>


  

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAqhj_A7f6GtpK-swJCDbSjne5zdy2XnAE",
    authDomain: "saryozek-taxi.firebaseapp.com",
    projectId: "saryozek-taxi",
    storageBucket: "saryozek-taxi.firebasestorage.app",
    messagingSenderId: "758286199664",
    appId: "1:758286199664:web:a0b88b3b9c1316f878fdb5",
    measurementId: "G-7PMSMGB7K3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.saveToFirebase = async function (data) {
    const savedUser = JSON.parse(localStorage.getItem("user_data") || "{}");
    const userId = savedUser.id;

    if (!userId) {
      console.warn("❌ userId отсутствует — заказ не сохранён");
      return;
    }

    try {
      await setDoc(doc(db, "orders", String(userId)), {
        ...data,
        user_id: userId,
        username: savedUser.username || null,
        first_name: savedUser.first_name || null,
        phone: savedUser.phone || null,
        status: true,
        createdAt: new Date().toISOString()
      });
      console.log("✅ Заказ сохранён в Firebase:", userId);
    } catch (e) {
      console.error("❌ Ошибка при сохранении в Firebase:", e);
    }
  };

  window.checkExistingOrder = async function () {
    const savedUser = JSON.parse(localStorage.getItem("user_data") || "{}");
    const userId = savedUser.id;
    if (!userId) return;

    try {
      const snap = await getDoc(doc(db, "orders", String(userId)));
      if (snap.exists()) {
        const order = snap.data();
        if (order.status === true) {
          showSummary(order);
        }
      }
    } catch (e) {
      console.error("❌ Ошибка при получении заказа:", e);
    }
  };

  // Когда всё загрузилось
  window.addEventListener("load", () => {
    window.Telegram.WebApp.ready();

    const user = JSON.parse(localStorage.getItem("user_data") || "{}");

    document.getElementById("showUserId").textContent = user.id || "-";
    document.getElementById("showFirstName").textContent = user.first_name || "-";
    document.getElementById("showUsername").textContent = user.username ? "@" + user.username : "-";
    document.getElementById("showPhone").textContent = user.phone || "-";

    checkExistingOrder();
  });
</script>


</body>
</html>
